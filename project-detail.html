<!DOCTYPE html>
<html lang="ja"> <!-- lang属性を 'ja' に変更 -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- タイトルと説明を日本語に変更 -->
    <title>導入事例 - 基幹システム移行プロジェクト</title>

    <!-- SEO & OGP (日本語) -->
    <meta name="description" content="未来の成長を支える経営基盤の構築。リソースが限られる中、全部門を巻き込んで完遂した基幹システム移行プロジェクトの事例紹介。">
    <meta property="og:title" content="導入事例 - 基幹システム移行プロジェクト">
    <meta property="og:description" content="部門ごとに独立していた旧システムを新システムに統合し、業務効率化と内部統制の強化を実現したプロジェクト。">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://kou511.github.io/portfolio/project-detail.html"> <!-- URLを日本語版に変更 -->
    <meta property="og:image" content="https://kou511.github.io/portfolio/images/ogp-system-migration.webp"> 

    <!-- Favicon -->
    <link rel="icon" href="images/favicon.webp">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">

    <!-- Flicker-Fix Script (Default to Dark Mode) -->
    <script>
        if (localStorage.getItem('theme') === 'light') {
            document.documentElement.classList.remove('dark');
        } else {
            document.documentElement.classList.add('dark'); // Default to dark
        }
    </script>

    <!-- Fonts, CSS, Icons -->
    <!-- 日本語フォント(Noto Sans JP)を追加し、Poppinsを削除 -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet"></noscript>
    
    <script src="https://cdn.tailwindcss.com" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>

    <style>
        :root {
            /* Light Mode Theme */
            --primary-color: #03887B;      /* Deep Mint Green */
            --secondary-color: #6F2DA8;   /* Deep Purple */
            --bg-main: #FAFAFA;           /* Bright off-white */
            --bg-card: rgba(255, 255, 255, 0.8);
            --border-color: #e5e5e5;      /* Neutral-200 */
            --text-main: #212121;         /* Deep black */
            --text-sub: #737373;          /* Neutral-500 */
            --shadow-color: rgba(0,0,0,0.07);
            --dynamic-grad-opacity: 0.05;
            --btn-text-color: #FAFAFA;
            --accent-gradient: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        html.dark {
            /* Dark Mode Theme */
            --primary-color: #00CBAA;      /* Emerald Green */
            --secondary-color: #9D4EDD;   /* Vibrant Violet */
            --bg-main: #171717;           /* Near-black gray */
            --bg-card: rgba(39, 39, 39, 0.6); /* Translucent #272727 */
            --border-color: rgba(0, 203, 170, 0.2); /* Translucent primary */
            --text-main: #F3F3F3;         /* Pure white */
            --text-sub: #a1a1aa;          /* Mid-gray */
            --shadow-color: rgba(0,0,0,0.5);
            --dynamic-grad-opacity: 0.07;
            --btn-text-color: #171717;
        }
        
        html { scroll-behavior: smooth; }
        body {
            /* font-familyを日本語用に変更 */
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            overflow-x: hidden;
            transition: background-color 0.4s, color 0.4s;
            font-weight: 400; /* 標準の太さを400に */
        }
        /* 見出しは太字に（日本語フォントのウェイトを調整） */
        h1, h2, h3, h4, h5, h6 { font-weight: 700; }
        /* Poppinsに合わせていた箇所を調整 */
        .font-normal { font-weight: 400; }
        .font-semibold { font-weight: 500; }

        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 15% 50%, var(--primary-color), transparent 40%),
                        radial-gradient(circle at 85% 30%, var(--secondary-color), transparent 40%),
                        radial-gradient(circle at 50% 90%, #3a2d80, transparent 50%);
            background-color: var(--bg-main); opacity: var(--dynamic-grad-opacity); z-index: -1;
            animation: gradient-flow 20s ease-in-out infinite;
            transition: opacity 0.4s;
        }
        @keyframes gradient-flow {
            0%, 100% { background-position: 0% 50%, 0% 50%, 0% 50%; }
            50% { background-position: 100% 50%, 100% 50%, 100% 50%; }
        }

        .glass-card {
            background: var(--bg-card); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color); border-radius: 1rem;
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s, background-color 0.4s;
            position: relative; overflow: hidden;
        }
        .glass-card::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 500 500' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E"); background-repeat: repeat; opacity: 0.025; }
        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 30px var(--shadow-color);
            border-color: rgba(0, 203, 170, 0.5);
        }

        #loader {
            position: fixed; inset: 0; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            background-color: var(--bg-main); color: var(--primary-color);
            font-size: 2rem; font-weight: bold;
            transition: opacity 0.5s, visibility 0.5s;
        }
        #loader.hidden { opacity: 0; visibility: hidden; }
        
        .controls-container {
            position: fixed; 
            top: 1.5rem; right: 1.5rem; 
            z-index: 51;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        #theme-toggle {
            background: var(--bg-card); border: 1px solid var(--border-color);
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        #theme-toggle i { color: var(--text-sub); transition: color 0.3s, transform 0.3s; }
        #theme-toggle:hover i { color: var(--primary-color); transform: rotate(15deg); }
        
        .gradient-text {
            background: var(--accent-gradient);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; color: transparent;
        }

        #hero-bg {
            background-image: url('images/System_Migration.webp');
            background-size: cover; background-position: center; position: relative;
        }
        #hero-bg::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(180deg, rgba(23, 23, 23, 0.9) 0%, rgba(23, 23, 23, 0.7) 100%);
            z-index: 1;
        }
        html:not(.dark) #hero-bg::before {
             background: linear-gradient(180deg, rgba(250, 250, 250, 0.9) 0%, rgba(250, 250, 250, 0.7) 100%);
        }
        #hero-bg > * { position: relative; z-index: 2; }

        .timeline-card { 
            position: relative; padding-left: 4rem; padding-bottom: 2.5rem;
        }
        .timeline-card:last-child { padding-bottom: 0; }
        .timeline-card::before {
            content: ''; position: absolute; left: 28px; top: 0.5rem;
            width: 2px; height: 100%; background: var(--border-color); 
        }
        .timeline-card:last-child::before { display: none; }
        
        .timeline-icon {
            position: absolute; left: 0; top: 0; width: 60px; height: 60px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: var(--btn-text-color); background: var(--primary-color);
            border: 2px solid var(--border-color); z-index: 1; transition: all 0.3s;
        }

        .section-nav {
            position: fixed; top: 50%; left: 2rem; transform: translateY(-50%);
            z-index: 50; display: none;
        }
        @media (min-width: 1280px) { .section-nav { display: block; } }
        .section-nav ul { list-style: none; padding: 0; margin: 0; }
        .section-nav a {
            display: flex; align-items: center;
            padding: 0.5rem 0; color: var(--text-sub);
            text-decoration: none; font-size: 0.875rem; font-weight: 500;
            position: relative; transition: color 0.3s;
        }
        .section-nav a::before {
            content: ''; display: inline-block; width: 8px; height: 8px;
            background-color: var(--text-sub); border-radius: 50%;
            margin-right: 1rem; transition: all 0.3s;
        }
        .section-nav a.active, .section-nav a:hover { color: var(--primary-color); }
        .section-nav a.active::before, .section-nav a:hover::before {
            background-color: var(--primary-color);
            transform: scale(1.5);
        }

        .reveal { opacity: 0; transform: translateY(50px); }
        
        .timeline-icon-wrapper {
            position: relative; z-index: 1;
        }
        .timeline-icon-circle {
            width: 64px; height: 64px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            border-width: 2px; margin: 0 auto;
            background-color: var(--bg-main);
            transition: all 0.4s ease-in-out;
        }
        .reveal-child:hover .timeline-icon-circle {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 0 20px var(--primary-color);
        }

        .btn-custom-text {
            color: var(--btn-text-color);
        }

        /* Process Map Styles */
        .process-map-container { position: relative; }
        .main-workflow-nav-item, .sub-workflow-card, .data-record-item, .connector-line {
             transition: opacity 0.4s ease-in-out, transform 0.3s ease-in-out;
        }
        .filtered-out { opacity: 0.2; pointer-events: none; }
        .filter-btn { 
            transition: all 0.3s ease; 
            background: var(--bg-card);
            border: 1px solid var(--border-color);
        }
        .filter-btn:hover {
             border-color: var(--primary-color);
        }
        .filter-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: var(--btn-text-color);
            box-shadow: 0 0 15px var(--primary-color);
        }

        .main-workflow-nav-item { cursor: pointer; border-left: 4px solid transparent; }
        .main-workflow-nav-item.active {
            border-left-color: var(--primary-color);
            background-color: rgba(0, 203, 170, 0.1);
        }
        html:not(.dark) .main-workflow-nav-item.active {
             background-color: rgba(3, 136, 123, 0.1);
        }
        
        #connector-lines {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
        }
        .connector-line { stroke-width: 2px; stroke: var(--primary-color); fill: none; }
        .sub-workflow-card { cursor: pointer; }
        .workflow-details-container { max-height: 0; overflow: hidden;
            transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out, opacity 0.5s ease-in-out;
            margin-top: 0; opacity: 0; cursor: default;
        }
        .workflow-details-container.open { max-height: 500px; margin-top: 0.75rem; opacity: 1; }
        .expand-indicator .icon { transition: transform 0.3s ease-in-out; }
        .sub-workflow-card.expanded .expand-indicator .icon { transform: rotate(180deg); }
        .auto-notify {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .team-tag-dev  { color: #34d399; } /* Emerald */
        .team-tag-mfg  { color: #fbbf24; } /* Amber */
        .team-tag-scm  { color: #60a5fa; } /* Blue */
        .team-tag-qa   { color: #f472b6; } /* Pink */

        /* 日本語の行間調整 */
        .leading-relaxed { line-height: 1.8; }
    </style>
</head>
<body class="antialiased">

    <!-- ローダーのテキストを日本語に変更 -->
    <div id="loader">読み込み中...</div>
    <div class="controls-container">
        <!-- 言語切り替えリンクを 'EN' に変更し、英語版のパスを指定 -->
        <a href="project-detail_en.html" class="text-[var(--text-sub)] hover:text-[var(--primary-color)] transition-colors font-bold text-lg" aria-label="Switch to English">EN</a>
        <button id="theme-toggle" aria-label="Toggle theme"><i class="fas fa-sun"></i></button>
    </div>

    <header class="fixed top-0 left-0 z-50 p-6">
        <!-- 戻るリンクのテキストとパスを日本語版用に変更 -->
        <a href="index.html" class="glass-card inline-block px-4 py-2 text-sm hover:!border-[var(--primary-color)] transition-all">
            <i class="fas fa-arrow-left mr-2"></i>ポートフォリオに戻る
        </a>
    </header>

    <!-- セクションナビゲーションを日本語に変更 -->
    <nav class="section-nav">
        <ul>
            <li><a href="#overview" class="active">概要</a></li>
            <li><a href="#timeline">歩み</a></li>
            <li><a href="#challenge">課題</a></li>
            <li><a href="#action">プロセス</a></li>
            <li><a href="#process-map">業務フロー</a></li>
            <li><a href="#result">成果</a></li>
            <li><a href="#takeaways">学び</a></li>
        </ul>
    </nav>

    <div class="flex">
        <main class="w-full max-w-screen-lg mx-auto p-4 md:p-12 space-y-24">

            <section id="hero-bg" class="rounded-2xl py-24 md:py-40 mt-16">
                <div id="hero" class="text-center px-4">
                    <!-- Heroセクションのテキストを日本語に変更 -->
                    <p class="text-lg text-[var(--primary-color)] font-semibold reveal">プロジェクトケーススタディ</p>
                    <h1 class="text-4xl md:text-6xl mt-2 mb-6 gradient-text reveal">基幹システム移行プロジェクト</h1>
                    <p class="text-xl leading-relaxed font-normal max-w-3xl mx-auto text-[var(--text-main)] reveal">
                        未来の成長を支える経営基盤の構築。リソースが限られる中、全部門を巻き込んで完遂したプロジェクト。
                    </p>
                </div>
            </section>

            <!-- 概要セクションを日本語に変更 -->
            <section id="overview" data-gsap-stagger>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="glass-card p-8 text-center reveal-child">
                        <i class="fas fa-user-tie text-4xl text-[var(--primary-color)] mb-3"></i>
                        <h3 class="text-xl mb-2">私の役割</h3>
                        <p class="text-[var(--text-sub)]">プロジェクトマネージャー</p>
                    </div>
                    <div class="glass-card p-8 text-center reveal-child">
                        <i class="fas fa-calendar-alt text-4xl text-[var(--primary-color)] mb-3"></i>
                        <h3 class="text-xl mb-2">プロジェクト期間</h3>
                        <p class="text-[var(--text-sub)]">約1年間</p> 
                    </div>
                    <div class="glass-card p-8 text-center reveal-child">
                        <i class="fas fa-check-double text-4xl text-[var(--primary-color)] mb-3"></i>
                        <h3 class="text-xl mb-2">目的</h3>
                        <p class="text-[var(--text-sub)]">業務効率化と内部統制の強化</p> 
                    </div>
                </div>
            </section>
            
            <!-- タイムラインセクションを日本語に変更 -->
            <section id="timeline">
                <div class="section-title text-center mb-16">
                    <h2 class="reveal gradient-text">プロジェクトの歩み</h2>
                </div>
                <div class="relative max-w-4xl mx-auto px-4" data-gsap-stagger>
                    <div class="absolute top-8 left-0 w-full h-0.5 bg-[var(--border-color)]"></div>
                    <div class="relative grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-12">
                        <div class="text-center reveal-child">
                            <div class="timeline-icon-wrapper">
                                <div class="timeline-icon-circle border-[var(--secondary-color)]">
                                    <i class="fas fa-unlink text-2xl text-[var(--secondary-color)]"></i>
                                </div>
                            </div>
                            <h3 class="text-xl mt-4 mb-2">課題</h3>
                            <p class="text-sm text-[var(--text-sub)]">独立した旧システムと<br>部門間の連携不足</p>
                        </div>
                        <div class="text-center reveal-child">
                            <div class="timeline-icon-wrapper">
                                <div class="timeline-icon-circle border-[var(--primary-color)]">
                                    <i class="fas fa-sitemap text-2xl text-[var(--primary-color)]"></i>
                                </div>
                            </div>
                            <h3 class="text-xl mt-4 mb-2">実行</h3>
                            <p class="text-sm text-[var(--text-sub)]">全社的な計画策定と<br>対話重視のプロジェクト推進</p> 
                        </div>
                        <div class="text-center reveal-child">
                            <div class="timeline-icon-wrapper">
                                <div class="timeline-icon-circle border-yellow-400">
                                    <i class="fas fa-building-shield text-2xl text-yellow-400"></i>
                                </div>
                            </div>
                            <h3 class="text-xl mt-4 mb-2">成果</h3>
                            <p class="text-sm text-[var(--text-sub)]">統制の取れた<br>経営基盤の確立</p> 
                        </div>
                    </div>
                </div>
            </section>

            <!-- 課題セクションを日本語に変更 -->
            <section id="challenge">
                <div class="section-title text-center mb-12"><h2 class="reveal gradient-text">背景と課題</h2></div>
                <div class="glass-card p-8 md:p-12 reveal">
                    <div class="space-y-8">
                        <div>
                            <h3 class="text-2xl mb-4 flex items-center"><i class="fas fa-building text-2xl text-[var(--secondary-color)] mr-4"></i>状況: 成長に伴うシステムの課題</h3>
                            <p class="text-[var(--text-sub)] leading-relaxed pl-10 font-normal">
                                プロジェクト以前、当社は部門ごとに最適化された旧システムを利用していました。しかし、事業が拡大するにつれ、システム間の連携が課題として顕在化。データは各部門で管理され、手作業による連携業務が増加していました。さらに、将来的な事業拡大を見据えた際、既存システムでは内部統制強化の要件を満たすことが困難であり、経営上の主要な課題となっていました。
                            </p>
                        </div>
                        <div>
                            <h3 class="text-2xl mb-4 flex items-center"><i class="fas fa-exclamation-triangle text-2xl text-yellow-400 mr-4"></i>困難: 予期せぬ懸念と技術的課題</h3>
                            <p class="text-[var(--text-sub)] leading-relaxed pl-10 font-normal">
                               当初の計画ではスムーズな進行が見込まれましたが、一部の部門から新しい仕組みへの変更に対する懸念の声が上がりました。また、旧システムからのデータ移行テストで予期せぬ問題が発覚し、一時的にスケジュールへの懸念が生じました。限られたリソースの中、技術的な課題と関係者の合意形成を同時に進める必要がありました。
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- プロセスセクションを日本語に変更 -->
            <section id="action">
                <div class="section-title text-center mb-12"><h2 class="reveal gradient-text">課題解決のプロセス</h2></div>
                <div class="max-w-3xl mx-auto" data-gsap-stagger>
                    <div class="timeline-card reveal-child">
                        <div class="timeline-icon"><i class="fas fa-clipboard-list"></i></div>
                        <div class="glass-card p-8"><h3 class="text-xl mb-2">計画と対話</h3><p class="text-[var(--text-sub)] font-normal leading-relaxed">詳細な計画がプロジェクトの基盤でした。まず全関連部門へのヒアリングを重ね、現場の課題とニーズを把握。それをもとにタスクを最小単位まで詳細化したWBS（作業分解構成図）を作成し、「いつまでに、誰が、何をすべきか」を明確にした「設計図」を全メンバーで共有しました。</p></div>
                    </div>
                    <div class="timeline-card reveal-child">
                        <div class="timeline-icon"><i class="fas fa-users-cog"></i></div>
                        <div class="glass-card p-8"><h3 class="text-xl mb-2">全部門を巻き込む推進力</h3><p class="text-[var(--text-sub)] font-normal leading-relaxed">システム移行はIT部門だけの仕事ではありません。各部門のキーパーソンに初期段階から参加してもらい、「自分たちのシステムを作る」という当事者意識を醸成。寄せられる意見に真摯に耳を傾け、粘り強い対話で信頼を築き、隔週の定例会で進捗を透明化し、課題をその場で解決するチーム文化を育みました。</p></div>
                    </div>
                    <div class="timeline-card reveal-child">
                        <div class="timeline-icon"><i class="fas fa-shield-alt"></i></div>
                        <div class="glass-card p-8"><h3 class="text-xl mb-2">リスクの特定と準備</h3><p class="text-[var(--text-sub)] font-normal leading-relaxed">「起こりうる全ての障害」を想定し、技術的な問題から人員調整の項目までを網羅的にリストアップ。それぞれに具体的な対応策（コンティンジェンシープラン）を用意しました。問題が確認されたデータ移行については、IT部門と協力して原因を分析し、移行手順とツール自体を改善して対応しました。</p></div>
                    </div>
                    <div class="timeline-card reveal-child">
                        <div class="timeline-icon"><i class="fas fa-redo"></i></div>
                        <div class="glass-card p-8"><h3 class="text-xl mb-2">入念なリハーサル</h3><p class="text-[var(--text-sub)] font-normal leading-relaxed">本番移行の成否は準備の質にかかっています。データ移行、システム切り替え、エンドユーザーを巻き込んだ運用チェックまで、本番に近い手順でのリハーサルを複数回実施。実施のたびに課題を特定・改善確認・調整・習熟を重ね、移行プロセスの精度を高めました。この準備がスムーズな移行とチームの安心感につながったと考えています。</p></div>
                    </div>
                </div>
            </section>
            
            <!-- 業務フローセクションを日本語に変更 -->
            <section id="process-map" class="reveal">
                <div class="section-title text-center mb-12">
                    <h2 class="gradient-text">改革後の抽象化された業務フロー</h2>
                </div>
                <p class="text-center text-lg text-[var(--text-sub)] max-w-3xl mx-auto mb-8">実際の業務＋システムフローを抽象化して作成した図です。左のフェーズを選択し、部門でフィルタリングすると、関連するプロセスと成果物がハイライトされます。</p>
                
                 <div class="glass-card p-4 md:p-8">
                    <div id="team-filter" class="flex justify-center flex-wrap gap-2 mb-8">
                        <!-- フィルタボタンを日本語に変更 -->
                        <button data-team="all" class="filter-btn active py-2 px-4 rounded-full">全部門</button>
                        <button data-team="dev" class="filter-btn py-2 px-4 rounded-full">開発/技術</button>
                        <button data-team="mfg" class="filter-btn py-2 px-4 rounded-full">製造</button>
                        <button data-team="scm" class="filter-btn py-2 px-4 rounded-full">SCM</button>
                        <button data-team="qa" class="filter-btn py-2 px-4 rounded-full">品質管理/保証</button>
                    </div>
                    
                    <div class="process-map-container flex flex-col md:flex-row gap-6 lg:gap-8">
                        <svg id="connector-lines" class="absolute top-0 left-0 w-full h-full pointer-events-none z-0"></svg>
                        
                        <nav class="w-full md:w-1/4 lg:w-1/5">
                            <div class="space-y-4">
                                <!-- フローナビゲーションを日本語に変更 -->
                                <div class="main-workflow-nav-item glass-card p-4" data-workflow="plan" data-teams="dev mfg scm">
                                    <h3 class="text-lg">1. 開発・引合</h3>
                                </div>
                                <div class="text-center text-2xl text-[var(--primary-color)]">↓</div>
                                 <div class="main-workflow-nav-item glass-card p-4" data-workflow="dev" data-teams="mfg scm dev">
                                    <h3 class="text-lg">2. 製造決定・生産</h3>
                                </div>
                                <div class="text-center text-2xl text-[var(--primary-color)]">↓</div>
                                 <div class="main-workflow-nav-item glass-card p-4" data-workflow="release" data-teams="mfg scm qa">
                                    <h3 class="text-lg">3. 検査・出荷</h3>
                                </div>
                            </div>
                        </nav>

                        <main id="workflow-details" class="w-full md:w-1/2 lg:w-3/5 glass-card p-6 min-h-[400px]">
                            <!-- プレースホルダーを日本語に変更 -->
                             <div class="flex items-center justify-center h-full text-[var(--text-sub)]"><p>左からワークフローの段階を選択してください。</p></div>
                        </main>

                        <aside class="w-full md:w-1/4 lg:w-1/5">
                             <div class="glass-card p-4 sticky top-6">
                                 <!-- 成果物リストのタイトルを日本語に変更 -->
                                 <h3 class="text-xl mb-4 border-b-2 border-[var(--border-color)] pb-2">成果物/システム</h3>
                                <ul id="data-records-list" class="space-y-2 text-sm text-[var(--text-sub)]">
                                   <!-- 成果物アイテムを日本語に変更 (IDは変更しない) -->
                                   <li id="record-request-sheet" data-teams="mfg scm" class="data-record-item flex items-center p-2 rounded-md transition-colors hover:bg-white/10 dark:hover:bg-white/5"><a href="#" class="flex items-center w-full"><i class="fas fa-file-excel fa-fw mr-3 text-green-400"></i><span>案件管理シート</span></a></li>
                                   <li id="record-shipping-form" data-teams="scm" class="data-record-item flex items-center p-2 rounded-md transition-colors hover:bg-white/10 dark:hover:bg-white/5"><a href="#" class="flex items-center w-full"><i class="fas fa-shipping-fast fa-fw mr-3 text-blue-400"></i><span>出荷依頼書</span></a></li>
                                   <li id="record-mfg-order" data-teams="scm mfg" class="data-record-item flex items-center p-2 rounded-md transition-colors hover:bg-white/10 dark:hover:bg-white/5"><a href="#" class="flex items-center w-full"><i class="fas fa-industry fa-fw mr-3 text-gray-400"></i><span>製造指示書</span></a></li>
                                   <li id="record-sales-system" data-teams="mfg" class="data-record-item flex items-center p-2 rounded-md transition-colors hover:bg-white/10 dark:hover:bg-white/5"><a href="#" class="flex items-center w-full"><i class="fas fa-cogs fa-fw mr-3 text-yellow-400"></i><span>販売管理システム</span></a></li>
                                   <li id="record-erp-system" data-teams="scm mfg" class="data-record-item flex items-center p-2 rounded-md transition-colors hover:bg-white/10 dark:hover:bg-white/5"><a href="#" class="flex items-center w-full"><i class="fas fa-server fa-fw mr-3 text-indigo-400"></i><span>基幹システム (ERP)</span></a></li>
                                   <li id="record-chat-tool" data-teams="dev scm mfg qa" class="data-record-item flex items-center p-2 rounded-md transition-colors hover:bg-white/10 dark:hover:bg-white/5"><a href="#" class="flex items-center w-full"><i class="fab fa-slack fa-fw mr-3 text-pink-400"></i><span>チャットツール</span></a></li>
                                   <li id="record-meeting-minutes" data-teams="dev mfg" class="data-record-item flex items-center p-2 rounded-md transition-colors hover:bg-white/10 dark:hover:bg-white/5"><a href="#" class="flex items-center w-full"><i class="fas fa-calendar-alt fa-fw mr-3 text-teal-400"></i><span>議事録</span></a></li>
                                </ul>
                            </div>
                        </aside>
                    </div>
                </div>
            </section>

            <!-- 成果セクションを日本語に変更 -->
            <section id="result">
                <div class="section-title text-center mb-12"><h2 class="reveal gradient-text">提供した価値</h2></div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8" data-gsap-stagger>
                    <div class="glass-card p-8 text-center reveal-child">
                        <i class="fas fa-check-circle text-5xl text-green-400 mb-4"></i>
                        <h3 class="text-xl mb-2">納期・予算通りの完遂</h3> 
                        <p class="text-[var(--text-sub)]">厳しい制約にもかかわらず、プロジェクトは計画通り、予算内で完了しました。</p> 
                    </div>
                    <div class="glass-card p-8 text-center reveal-child">
                        <i class="fas fa-chart-line text-5xl text-yellow-400 mb-4"></i>
                        <h3 class="text-xl mb-2">経営基盤の強化</h3> 
                        <p class="text-[var(--text-sub)]">内部統制強化の要件にも応えうる、透明性と信頼性の高いシステム基盤を構築しました。</p> 
                    </div>
                    <div class="glass-card p-8 text-center reveal-child">
                        <i class="fas fa-brain text-5xl text-[var(--primary-color)] mb-4"></i>
                        <h3 class="text-xl mb-2">データ駆動型文化の支援</h3>
                        <p class="text-[var(--text-sub)]">一元化されたデータにより、リアルタイムでの正確な状況把握が可能となり、データに基づいた迅速な意思決定を促進しました。</p>
                    </div>
                     <div class="glass-card p-8 text-center reveal-child">
                        <i class="fas fa-network-wired text-5xl text-[var(--secondary-color)] mb-4"></i>
                        <h3 class="text-xl mb-2">プロセス統合と一元化の強化</h3>
                        <p class="text-[var(--text-sub)]">統一されたデータ基盤と連携の自動化により、手作業を削減し、部門間のスムーズなコミュニケーションに貢献しました。</p>
                    </div>
                </div>
            </section>
            
            <!-- 学びセクションを日本語に変更 -->
            <section id="takeaways">
                <div class="section-title text-center mb-12"><h2 class="reveal gradient-text">学びと再現性</h2></div>
                <div class="grid grid-cols-1 gap-8">
                    <div class="glass-card p-8 md:p-12 reveal">
                        <h3 class="text-2xl mb-4 flex items-center"><i class="fas fa-lightbulb text-2xl text-[var(--secondary-color)] mr-4"></i>変化への「懸念」に向き合う重要性</h3>
                        <p class="text-[var(--text-sub)] leading-relaxed pl-10 font-normal">
                           当初の関係者からの懸念は、単なる変化への抵抗ではなく、新しいシステムやプロセスがもたらす影響への「不安」や理解不足から生じていたと捉えています。一方的に説明するのではなく、個別のヒアリングや対話を通じてその懸念を理解し、丁寧に解消するアプローチを取りました。関係者の視点や感情を理解し、共通の目的に向かう「協力者」として巻き込んでいくことが、プロジェクト成功の重要な鍵であることを学びました。
                        </p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8" data-gsap-stagger>
                        <div class="glass-card p-8 reveal-child">
                            <h3 class="text-xl mb-4 flex items-center"><i class="fas fa-tools text-[var(--primary-color)] mr-3"></i>活用したスキル</h3>
                            <ul class="space-y-2 text-[var(--text-sub)]">
                                <li class="flex items-center"><i class="fas fa-tasks mr-3 text-blue-400"></i>プロジェクト管理 (WBS)</li>
                                <li class="flex items-center"><i class="fas fa-users mr-3 text-yellow-400"></i>ステークホルダー管理</li>
                                <li class="flex items-center"><i class="fas fa-file-signature mr-3 text-green-400"></i>要件定義・業務フロー設計</li>
                                <li class="flex items-center"><i class="fas fa-database mr-3 text-indigo-400"></i>データ移行計画・実行</li>
                            </ul>
                        </div>
                        <div class="glass-card p-8 reveal-child">
                            <h3 class="text-xl mb-4 flex items-center"><i class="fas fa-lightbulb text-[var(--primary-color)] mr-3"></i>再現可能なポイント</h3>
                            <ul class="space-y-2 text-[var(--text-sub)]">
                                <li class="flex items-start"><i class="fas fa-check mr-3 mt-1 text-green-400"></i><p><strong>明確な計画:</strong> WBSでタスクを分解し、責任と期限を明確化する。</p></li>
                                <li class="flex items-start"><i class="fas fa-check mr-3 mt-1 text-green-400"></i><p><strong>対話による巻き込み:</strong> 関係者の意見に耳を傾け、対話で懸念を解消し、当事者意識を育む。</p></li>
                                <li class="flex items-start"><i class="fas fa-check mr-3 mt-1 text-green-400"></i><p><strong>リハーサルの重視:</strong> 本番を想定したリハーサルでリスクを洗い出し、チームの習熟度を高める。</p></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <section class="text-center reveal">
                 <!-- 戻るリンクのテキストとパスを日本語版用に変更 -->
                 <a href="index.html" class="inline-block bg-[var(--primary-color)] hover:bg-[var(--secondary-color)] font-bold py-3 px-8 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg shadow-[var(--primary-color)]/20 btn-custom-text">
                    <i class="fas fa-arrow-left mr-2"></i> ポートフォリオに戻る
                </a>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const docHtml = document.documentElement;
            
            // --- THEME ---
            const loader = document.getElementById('loader');
            if (loader) { 
                 loader.classList.add('hidden');
            } else {
                console.error("Loader element not found!"); 
            }

            const themeToggle = document.getElementById('theme-toggle');
            const toggleIcon = themeToggle ? themeToggle.querySelector('i') : null;

            function applyTheme() {
                if (!toggleIcon) return; 

                const isDark = docHtml.classList.contains('dark');
                toggleIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon'; 

                setTimeout(() => {
                    if (window.processMap && typeof window.processMap.drawConnections === 'function') {
                        window.processMap.drawConnections();
                    }
                }, 100); 
            }
            
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    docHtml.classList.toggle('dark'); 
                    localStorage.setItem('theme', docHtml.classList.contains('dark') ? 'dark' : 'light');
                    applyTheme(); 
                });
            }

            applyTheme();
            
            // --- GSAP ANIMATIONS ---
            gsap.registerPlugin(ScrollTrigger);
            gsap.utils.toArray('[data-gsap-stagger]').forEach(container => {
                const targets = container.querySelectorAll('.reveal-child');
                if(targets.length > 0) {
                    gsap.fromTo(targets, { opacity: 0, y: 50 }, {
                        opacity: 1, y: 0, duration: 0.8, ease: 'power3.out', stagger: 0.2,
                        scrollTrigger: { trigger: container, start: 'top 85%', toggleActions: 'play none none none' }
                    });
                }
            });
            gsap.utils.toArray('.reveal').forEach(elem => {
                gsap.fromTo(elem, { opacity: 0, y: 50 }, {
                    opacity: 1, y: 0, duration: 1, ease: 'power3.out',
                    scrollTrigger: { trigger: elem, start: 'top 90%', toggleActions: 'play none none none' }
                });
            });
            
            // --- SECTION NAVIGATION ---
            const sections = gsap.utils.toArray('main section');
            const navLinks = gsap.utils.toArray('.section-nav a');
            sections.forEach(section => {
                ScrollTrigger.create({
                    trigger: section,
                    start: 'top center',
                    end: 'bottom center',
                    onToggle: self => {
                        const navLink = document.querySelector(`.section-nav a[href="#${section.id}"]`);
                        if (navLink) {
                            if (self.isActive) {
                                navLinks.forEach(link => link.classList.remove('active'));
                                navLink.classList.add('active');
                            }
                        }
                    }
                });
            });

            // --- PROCESS MAP LOGIC ---
            const processMapDemo = document.getElementById('process-map');
            if (processMapDemo) {
                const navItems = processMapDemo.querySelectorAll('.main-workflow-nav-item');
                const detailsPanel = processMapDemo.querySelector('#workflow-details');
                const svg = processMapDemo.querySelector('#connector-lines');
                const mainContainer = processMapDemo.querySelector('.process-map-container');
                const filterButtons = processMapDemo.querySelectorAll('.filter-btn');
                const dataRecordItems = processMapDemo.querySelectorAll('.data-record-item');

                let currentFilter = 'all';

                // --- ワークフローのテンプレートを日本語に変更 ---
                const workflowTemplates = {
                    plan: `
                        <div class="space-y-4">
                            <div class="sub-workflow-card glass-card p-4" data-teams="dev mfg" data-connects-to="record-meeting-minutes">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">市場調査・ニーズ分析</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-dev text-sm font-semibold">開発/技術</span><span class="team-tag-mfg text-sm font-semibold">製造</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">市場や潜在顧客のニーズを調査・分析。内外の情報を元に、新製品のコンセプトを企画・立案し、事業の方向性を定めます。</p></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                             <div class="sub-workflow-card glass-card p-4" data-teams="mfg" data-connects-to="record-request-sheet record-sales-system">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">案件情報の入力</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-mfg text-sm font-semibold">製造</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">顧客からの引合情報を取得し、所定の案件管理シートに入力。この段階で詳細な情報を提供することが、後の先行生産などの判断を容易にします。</p></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                             <div class="sub-workflow-card glass-card p-4" data-teams="mfg scm" data-connects-to="record-chat-tool">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">内部承認・引継ぎ</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-mfg text-sm font-semibold">製造</span><span class="team-tag-scm text-sm font-semibold">SCM</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">案件管理シートを作成し、責任者の承認を得ます。承認が完了するとステータスが自動更新され、チャットツール経由で次部門へ確認依頼が通知されます。</p><div class="auto-notify"><i class="fas fa-robot"></i><span>ステータス変更で自動通知</span></div></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                        </div>`,
                    dev: `
                        <div class="space-y-4">
                            <div class="sub-workflow-card glass-card p-4" data-teams="scm" data-connects-to="record-shipping-form">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">出荷依頼書の起案</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-scm text-sm font-semibold">SCM</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">後続部門は承認された内容に基づき、出荷依頼書を起案。在庫の引当、輸送手段、法規制などを確認し、出荷日に基づいたスケジュールを作成します。</p></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                            <div class="sub-workflow-card glass-card p-4" data-teams="scm dev mfg" data-connects-to="record-mfg-order record-erp-system">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">多段階承認・生産計画</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-scm text-sm font-semibold">SCM</span><span class="team-tag-dev text-sm font-semibold">開発/技術</span><span class="team-tag-mfg text-sm font-semibold">製造</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">チャットツール上で、関連部門の責任者による多段階の承認プロセスが進行。すべての承認が完了すると、生産計画担当者が製造指示書を発行し、基幹システムに登録します。</p><div class="auto-notify"><i class="fas fa-robot"></i><span>承認完了で自動通知</span></div></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                             <div class="sub-workflow-card glass-card p-4" data-teams="mfg scm" data-connects-to="record-mfg-order">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">生産開始・進捗管理</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-mfg text-sm font-semibold">製造</span><span class="team-tag-scm text-sm font-semibold">SCM</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">製造チームは計画に基づき生産を開始。進捗は専用の管理シートに記録され、完了時には案件シートや基幹システムの関連情報がすべて更新されます。</p></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                        </div>`,
                    release: `
                         <div class="space-y-4">
                            <div class="sub-workflow-card glass-card p-4" data-teams="qa" data-connects-to="record-request-sheet">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">品質検査・証明書発行</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-qa text-sm font-semibold">品質管理/保証</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">品質管理部門が製造された製品を検査。顧客の要求に応じて品質証明書が発行され、検査完了がシステムに記録されます。完了ステータスはチャットツールで関係者に自動通知されます。</p><div class="auto-notify"><i class="fas fa-robot"></i><span>検査完了で自動通知</span></div></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                            <div class="sub-workflow-card glass-card p-4" data-teams="scm mfg" data-connects-to="record-shipping-form">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">梱包・出荷手配</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-scm text-sm font-semibold">SCM</span><span class="team-tag-mfg text-sm font-semibold">製造</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">検査に合格した製品は、案件管理シートの指示に基づき梱包されます。物流部門は出荷依頼書に基づき輸送便を手配し、出荷準備が完了したら関係者に通知します。</p></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                            <div class="sub-workflow-card glass-card p-4" data-teams="mfg scm" data-connects-to="record-sales-system record-erp-system">
                                <div class="flex justify-between items-start gap-2"><h4 class="text-lg">出荷後処理・請求</h4><div class="flex gap-1 flex-wrap justify-end shrink-0"><span class="team-tag-mfg text-sm font-semibold">製造</span><span class="team-tag-scm text-sm font-semibold">SCM</span></div></div>
                                <div class="workflow-details-container"><p class="text-sm text-[var(--text-sub)] leading-relaxed">集荷後、物流部門はステータスを更新し、関連システムと情報を同期。顧客への納品が確認された後、営業担当者が販売管理システムを通じて適切なタイミングで請求書を発行します。</p><div class="auto-notify"><i class="fas fa-robot"></i><span>出荷・納品時に自動通知</span></div></div>
                                <div class="expand-indicator flex items-center justify-end text-sm text-[var(--text-sub)] mt-2"><span>詳細</span><svg class="icon w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>
                            </div>
                        </div>`
                };

                const drawConnections = () => {
                    if (!svg || !mainContainer || !detailsPanel) return;
                    svg.innerHTML = '';
                    const connectingElements = detailsPanel.querySelectorAll('.sub-workflow-card:not(.filtered-out)[data-connects-to]');
                    if (connectingElements.length === 0) return;

                    const containerRect = mainContainer.getBoundingClientRect();

                    connectingElements.forEach(sourceEl => {
                        const targetIds = sourceEl.dataset.connectsTo.split(' ');
                        targetIds.forEach(targetId => {
                            const targetEl = document.getElementById(targetId.trim());

                            if (targetEl && !targetEl.classList.contains('filtered-out')) {
                                const sourceRect = sourceEl.getBoundingClientRect();
                                const targetRect = targetEl.getBoundingClientRect();

                                const x1 = sourceRect.right - containerRect.left;
                                const y1 = sourceRect.top - containerRect.top + sourceRect.height / 2;
                                const x2 = targetRect.left - containerRect.left;
                                const y2 = targetRect.top - containerRect.top + targetRect.height / 2;
                                
                                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                                const d = `M ${x1} ${y1} C ${x1 + 60} ${y1}, ${x2 - 60} ${y2}, ${x2} ${y2}`;
                                path.setAttribute('d', d);
                                path.setAttribute('class', 'connector-line');
                                svg.appendChild(path);
                            }
                        });
                    });
                };

                const applyFilter = () => {
                    const highlight = (items) => {
                         items.forEach(item => {
                            const itemTeams = item.dataset.teams ? item.dataset.teams.split(' ') : [];
                            if (currentFilter === 'all' || itemTeams.includes(currentFilter)) {
                                item.classList.remove('filtered-out');
                            } else {
                                item.classList.add('filtered-out');
                            }
                        });
                    };
                    
                    highlight(navItems);
                    highlight(detailsPanel.querySelectorAll('.sub-workflow-card'));
                    highlight(dataRecordItems);
                    
                    requestAnimationFrame(drawConnections);
                };

                const displayWorkflow = (workflowId) => {
                    const templateHTML = workflowTemplates[workflowId];
                    if (templateHTML && detailsPanel) {
                        detailsPanel.innerHTML = templateHTML;
                        
                        const cards = detailsPanel.querySelectorAll('.sub-workflow-card');
                        cards.forEach(card => {
                            card.addEventListener('click', (e) => {
                                if (e.target.closest('a')) { return; }
                                
                                const details = card.querySelector('.workflow-details-container');
                                if (details) {
                                    const wasOpen = details.classList.contains('open');
                                    detailsPanel.querySelectorAll('.workflow-details-container.open').forEach(d => {
                                        if (d !== details) {
                                            d.classList.remove('open');
                                            const parentCard = d.closest('.sub-workflow-card');
                                            if (parentCard) parentCard.classList.remove('expanded');
                                        }
                                    });

                                    card.classList.toggle('expanded', !wasOpen);
                                    details.classList.toggle('open', !wasOpen);
                                    
                                    setTimeout(drawConnections, 500);
                                }
                            });
                        });
                        applyFilter();
                    } else if(detailsPanel) {
                        // プレースホルダーを日本語に変更
                        detailsPanel.innerHTML = `<div class="flex items-center justify-center h-full text-[var(--text-sub)]"><p>左からワークフローの段階を選択してください。</p></div>`;
                        if(svg) svg.innerHTML = '';
                    }
                };

                navItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const workflowId = item.dataset.workflow;
                        navItems.forEach(nav => nav.classList.remove('active'));
                        item.classList.add('active');
                        displayWorkflow(workflowId);
                    });
                });

                filterButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        currentFilter = button.dataset.team;
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        applyFilter();
                    });
                });

                window.addEventListener('resize', () => setTimeout(drawConnections, 100));
                if (detailsPanel) {
                    detailsPanel.addEventListener('scroll', drawConnections, { passive: true });
                }
                
                if (navItems.length > 0) {
                     navItems[0].click();
                }

                 const mapObserver = new IntersectionObserver((entries) => {
                    if(entries[0].isIntersecting) {
                        setTimeout(drawConnections, 500);
                        mapObserver.unobserve(entries[0].target);
                    }
                }, { threshold: 0.1 });
                 if(processMapDemo) {
                     mapObserver.observe(processMapDemo);
                 }

                window.processMap = { drawConnections };
            }
        });
    </script>
</body>
</html>
